#!/bin/bash

HOSTNAME=$(hostname -f)
FROM="stanley@${HOSTNAME}"
SENDMAIL=`which sendmail`
LINE_BREAK=""

if [ $? -ne 0 ]; then
    echo "Unable to find sendmail binary in PATH" >&2
    exit 2
fi

MAIL="$SENDMAIL -t"
FOOTER="This message was generated by Stanley Action `basename $0` running on `hostname`"
TO=$1
shift
SUBJECT=$1
shift
SEND_EMPTY_BODY=$1
shift
CONTENT_TYPE=$1
shift
BODY="$@"

if [[ "${CONTENT_TYPE}" = "text/html" ]]; then
  LINE_BREAK="<br><br>"
else
  LINE_BREAK="\n\n"
fi

if [[ -z "${BODY// }" && $SEND_EMPTY_BODY == 'True' ]] || [[ -n $BODY ]]; then
  ${MAIL} <<EOF
TO: ${TO}
FROM: ${FROM}
SUBJECT: ${SUBJECT}
Content-Type: ${CONTENT_TYPE}

${BODY}
${LINE_BREAK}
${FOOTER}

EOF

fi

if [ $? -ne 0 ]; then
  echo "Failed to send mail to ${TO}"
  exit 2
else
  echo "Successfully sent mail to ${TO}"
  exit 0
fi
